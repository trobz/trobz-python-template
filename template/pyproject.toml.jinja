[project]
name = "{{ project_name }}"
version = "0.0.0"
description = "{{ project_description }}"
authors = [{name = "{{ author_username }}", email = "{{ author_email }}"}]
requires-python = ">=3.10"
readme = "README.md"
license = "AGPL-3.0"
license-files = ["LICENSE"]

dependencies = [
    {%- if project_type == 'cli' %}
    "typer>=0.20",
    {%- elif project_type == 'service' %}
    {%- if service_framework == 'fastapi' %}
    "fastapi>=0.110.0",
    {%- elif service_framework == 'flask' %}
    "flask>=3.0.0",
    {%- endif %}
    "uvicorn>=0.27.0",
    "pydantic-settings>=2.2.0",
    {%- endif %}
]

[project.urls]
Repository = "https://github.com/trobz/{{project_name}}"

{%- if project_type == 'cli' %}
[project.scripts]
{{ project_name }} = "{{ package_name }}.main:app"
{%- endif %}

[dependency-groups]
dev = [
    "pre-commit>=2.20.0",
    "ty>=0.0.1a16",
    "ruff>=0.11.5",
    "pytest>=7.2.0",
    "python-semantic-release>=10.5.3",
]

[tool.pytest.ini_options]
testpaths = ["tests"]

{#
uv build is declared to be stable and fast
benchmarked in https://x.com/charliermarsh/status/1940583972607873226
#}
[build-system]
requires = ["uv_build>=0.7.19,<0.8.0"]
build-backend = "uv_build"

[tool.uv.build-backend]
module-name = "{{ package_name }}"
module-root = ""


{% if enable_github_action -%}
[project.optional-dependencies]
build = ["uv ~= 0.7.12"]

[tool.semantic_release]
version_toml = ["pyproject.toml:project.version"]
build_command = """
  python -m pip install -e '.[build]'
  uv lock --upgrade-package {{project_name}}
  git add uv.lock
  uv build
"""

# Commit parser - this should be at the top level
commit_parser = "conventional"

# Allow 0.x.x versions (prevents jumping straight to 1.0.0)
allow_zero_version = true

# Don't do major version bumps when in 0.x.x
major_on_zero = false

# Tag format
tag_format = "v{version}"

[tool.semantic_release.changelog]
exclude_commit_patterns = [
    '''chore(?:\([^)]*?\))?: .+''',
    '''ci(?:\([^)]*?\))?: .+''',
    '''style(?:\([^)]*?\))?: .+''',
    '''test(?:\([^)]*?\))?: .+''',
    '''build\((?!deps\): .+)''',
    '''initial commit.*''',
]
{% endif -%}
